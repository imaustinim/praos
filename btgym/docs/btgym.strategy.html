

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>btgym.strategy package &mdash; BTGym 0.0.7 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="BTGym 0.0.7 documentation" href="index.html"/>
        <link rel="next" title="btgym.monitor package" href="btgym.monitor.html"/>
        <link rel="prev" title="btgym.dataserver module" href="btgym.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> BTGym
          

          
          </a>

          
            
            
              <div class="version">
                0.0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Package Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#quickstart">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#problem-definition">Problem definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#environment-engine-description">Environment engine description</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#data-flow-structure">Data flow structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#a3c-framework-description">A3C framework description</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="btgym.envs.html">btgym.envs package</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.html">btgym.dataserver module</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.html#module-btgym.server">btgym.server module</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.html#module-btgym.spaces">btgym.spaces module</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">btgym.strategy package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#btgym-strategy-base-module">btgym.strategy.base module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#btgym-strategy-observers-module">btgym.strategy.observers module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="btgym.monitor.html">btgym.monitor package</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.rendering.html">btgym.rendering package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="btgym.datafeed.html">btgym.datafeed package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="btgym.algorithms.html">btgym.algorithms package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="btgym.research.html">btgym.research package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BTGym</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>btgym.strategy package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/btgym.strategy.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="btgym-strategy-package">
<h1>btgym.strategy package<a class="headerlink" href="#btgym-strategy-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="btgym-strategy-base-module">
<h2>btgym.strategy.base module<a class="headerlink" href="#btgym-strategy-base-module" title="Permalink to this headline">¶</a></h2>
<span class="target" id="module-btgym.strategy.base"></span><dl class="class">
<dt id="btgym.strategy.base.BTgymBaseStrategy">
<em class="property">class </em><code class="descclassname">btgym.strategy.base.</code><code class="descname">BTgymBaseStrategy</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Controls Environment inner dynamics and backtesting logic. Provides gym’my (State, Action, Reward, Done, Info) data.
Any State, Reward and Info computation logic can be implemented by subclassing BTgymStrategy and overriding
get_[mode]_state(), get_reward(), get_info(), is_done() and set_datalines() methods.
One can always go deeper and override __init__ () and next() methods for desired
server cerebro engine behaviour, including order execution logic etc.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>base class supports single asset iteration via default data_line named ‘base_asset’, see derived classes
multi-asset support</li>
<li>bt.observers.DrawDown observer will be automatically added to BTgymStrategy instance at runtime.</li>
<li>Since it is bt.Strategy subclass, refer to <a class="reference external" href="https://www.backtrader.com/docu/strategy.html">https://www.backtrader.com/docu/strategy.html</a> for more information.</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Keyword Arguments:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><ul class="first last">
<li><p class="first"><strong>params</strong> (<em>dict</em>) – parameters dictionary, see Note below.</p>
</li>
<li><p class="first"><strong>Notes</strong> – Due to backtrader convention, any strategy arguments should be defined inside <cite>params</cite> dictionary
or passed as kwargs to bt.Cerebro() class via .addstrategy() method. Parameter dictionary
should contain at least these keys:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">state_shape</span><span class="p">:</span>        <span class="n">Observation</span> <span class="n">state</span> <span class="n">shape</span> <span class="ow">is</span> <span class="n">dictionary</span> <span class="n">of</span> <span class="n">Gym</span> <span class="n">spaces</span><span class="p">,</span> <span class="n">by</span> <span class="n">convention</span>
                    <span class="n">first</span> <span class="n">dimension</span> <span class="n">of</span> <span class="n">every</span> <span class="n">Gym</span> <span class="n">Box</span> <span class="n">space</span> <span class="ow">is</span> <span class="n">time</span> <span class="n">embedding</span> <span class="n">one</span><span class="p">;</span>
<span class="n">cash_name</span><span class="p">:</span>          <span class="nb">str</span><span class="p">,</span> <span class="n">name</span> <span class="k">for</span> <span class="n">cash</span> <span class="n">asset</span>
<span class="n">asset_names</span><span class="p">:</span>        <span class="n">iterable</span> <span class="n">of</span> <span class="nb">str</span><span class="p">,</span> <span class="n">names</span> <span class="k">for</span> <span class="n">assets</span>
<span class="n">start_cash</span><span class="p">:</span>         <span class="nb">float</span><span class="p">,</span> <span class="n">broker</span> <span class="n">starting</span> <span class="n">cash</span>
<span class="n">commission</span><span class="p">:</span>         <span class="nb">float</span><span class="p">,</span> <span class="n">broker</span> <span class="n">commission</span> <span class="n">value</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span> <span class="n">stands</span> <span class="k">for</span> <span class="mi">1</span><span class="o">%</span>
<span class="n">leverage</span><span class="p">:</span>           <span class="n">broker</span> <span class="n">leverage</span><span class="p">,</span> <span class="n">default</span> <span class="ow">is</span> <span class="mf">1.0</span>
<span class="n">order_size</span><span class="p">:</span>         <span class="nb">dict</span> <span class="n">of</span> <span class="n">fixed</span> <span class="n">order</span> <span class="n">stakes</span> <span class="p">(</span><span class="n">floats</span><span class="p">);</span> <span class="n">keys</span> <span class="n">should</span> <span class="n">match</span> <span class="n">assets</span> <span class="n">names</span><span class="o">.</span>
<span class="n">drawdown_call</span><span class="p">:</span>      <span class="n">finish</span> <span class="n">episode</span> <span class="n">when</span> <span class="n">hitting</span> <span class="n">this</span> <span class="n">drawdown</span> <span class="n">treshghold</span> <span class="p">,</span> <span class="ow">in</span> <span class="n">percent</span><span class="o">.</span>
<span class="n">target_call</span><span class="p">:</span>        <span class="n">finish</span> <span class="n">episode</span> <span class="n">when</span> <span class="n">reaching</span> <span class="n">this</span> <span class="n">profit</span> <span class="n">target</span><span class="p">,</span> <span class="ow">in</span> <span class="n">percent</span><span class="o">.</span>
<span class="n">portfolio_actions</span><span class="p">:</span>  <span class="n">possible</span> <span class="n">agent</span> <span class="n">actions</span><span class="o">.</span>
<span class="n">skip_frame</span><span class="p">:</span>         <span class="n">number</span> <span class="n">of</span> <span class="n">environment</span> <span class="n">steps</span> <span class="n">to</span> <span class="n">skip</span> <span class="n">before</span> <span class="n">returning</span> <span class="nb">next</span> <span class="n">response</span><span class="p">,</span>
                    <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="k">if</span> <span class="nb">set</span> <span class="n">to</span> <span class="mi">10</span> <span class="o">--</span> <span class="n">agent</span> <span class="n">will</span> <span class="n">interact</span> <span class="k">with</span> <span class="n">environment</span> <span class="n">every</span> <span class="mi">10</span><span class="n">th</span> <span class="n">step</span><span class="p">;</span>
                    <span class="n">every</span> <span class="n">other</span> <span class="n">step</span> <span class="n">agent</span> <span class="n">action</span> <span class="ow">is</span> <span class="n">assumed</span> <span class="n">to</span> <span class="n">be</span> <span class="s1">&#39;hold&#39;</span><span class="o">.</span>
</pre></div>
</div>
<p>Default values are:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">state_shape</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">raw_state</span><span class="o">=</span><span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">0</span><span class="p">,))</span>
<span class="n">cash_name</span><span class="o">=</span><span class="s1">&#39;default_cash&#39;</span>
<span class="n">asset_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default_asset&#39;</span><span class="p">]</span>
<span class="n">start_cash</span><span class="o">=</span><span class="kc">None</span>
<span class="n">commission</span><span class="o">=</span><span class="kc">None</span>
<span class="n">leverage</span><span class="o">=</span><span class="mf">1.0</span>
<span class="n">drawdown_call</span><span class="o">=</span><span class="mi">10</span>
<span class="n">target_call</span><span class="o">=</span><span class="mi">10</span>
<span class="n">dataset_stat</span><span class="o">=</span><span class="kc">None</span>
<span class="n">episode_stat</span><span class="o">=</span><span class="kc">None</span>
<span class="n">portfolio_actions</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;hold&#39;</span><span class="p">,</span> <span class="s1">&#39;buy&#39;</span><span class="p">,</span> <span class="s1">&#39;sell&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">)</span>
<span class="n">skip_frame</span><span class="o">=</span><span class="mi">1</span>
<span class="n">order_size</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.next">
<code class="descname">next</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.next"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.next" title="Permalink to this definition">¶</a></dt>
<dd><p>Default implementation for built-in backtrader method.
Defines one step environment routine;
Handles order execution logic according to action received.
Note that orders can only be submitted for data_lines in action_space (assets).
<cite>self.action</cite> attr. is updated by btgym.server._BTgymAnalyzer, and <cite>None</cite> actions
are emitted while doing <cite>skip_frame</cite> loop.</p>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.update_broker_stat">
<code class="descname">update_broker_stat</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.update_broker_stat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.update_broker_stat" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Updates all sliding broker statistics deques with latest-step values such as:</dt>
<dd><ul class="first last simple">
<li>normalized broker value</li>
<li>normalized broker cash</li>
<li>normalized exposure (position size)</li>
<li>exp. scaled episode duration in steps, normalized wrt. max possible episode steps</li>
<li>normalized realized profit/loss for last closed trade (is zero if no pos. closures within last env. step)</li>
<li>normalized profit/loss for current opened trade (unrealized p/l);</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_broker_value">
<code class="descname">get_broker_value</code><span class="sig-paren">(</span><em>current_value</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_broker_value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_broker_value" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>current_value</strong> – current portfolio value</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">normalized broker value.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_broker_cash">
<code class="descname">get_broker_cash</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_broker_cash"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_broker_cash" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">normalized broker cash</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_broker_exposure">
<code class="descname">get_broker_exposure</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_broker_exposure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_broker_exposure" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">normalized exposure (position size)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_broker_pos_direction">
<code class="descname">get_broker_pos_direction</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_broker_pos_direction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_broker_pos_direction" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">short/long/out position indicator</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_broker_realized_pnl">
<code class="descname">get_broker_realized_pnl</code><span class="sig-paren">(</span><em>current_value</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_broker_realized_pnl"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_broker_realized_pnl" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>current_value</strong> – current portfolio value</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">normalized realized profit/loss for last closed trade (is zero if no pos. closures within last env. step)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_broker_unrealized_pnl">
<code class="descname">get_broker_unrealized_pnl</code><span class="sig-paren">(</span><em>current_value</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_broker_unrealized_pnl"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_broker_unrealized_pnl" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>current_value</strong> – current portfolio value</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">normalized profit/loss for current opened trade</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_broker_episode_step">
<code class="descname">get_broker_episode_step</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_broker_episode_step"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_broker_episode_step" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">exp. scaled episode duration in steps, normalized wrt. max possible episode steps</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_broker_drawdown">
<code class="descname">get_broker_drawdown</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_broker_drawdown"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_broker_drawdown" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">current drawdown value</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.set_datalines">
<code class="descname">set_datalines</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.set_datalines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.set_datalines" title="Permalink to this definition">¶</a></dt>
<dd><p>Default datalines are: Open, Low, High, Close, Volume.
Any other custom data lines, indicators, etc. should be explicitly defined by overriding this method.
Invoked once by Strategy.__init__().</p>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_raw_state">
<code class="descname">get_raw_state</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_raw_state"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_raw_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Default state observation composer.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">4 - number of signal features  == state_shape[1],
n - time-embedding length  == state_shape[0] == &lt;set by user&gt;.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">and updates time-embedded environment state observation as [n,4] numpy matrix, where</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><cite>self.raw_state</cite> is used to render environment <cite>human</cite> mode and should not be modified.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_internal_state">
<code class="descname">get_internal_state</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_internal_state"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_internal_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Composes internal state tensor by calling all statistics from broker_stat dictionary.
Generally, this method should not be modified, implement corresponding get_broker_[mode]() methods.</p>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_state">
<code class="descname">get_state</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_state"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Collects estimated values for every mode of observation space by calling methods from
<cite>collection_get_state_methods</cite> dictionary.
As a rule, this method should not be modified, override or implement corresponding get_[mode]_state() methods,
defining necessary calculations and return arbitrary shaped tensors for every space mode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>‘data’ referes to bt.startegy datafeeds and should be treated as such.</dt>
<dd><dl class="first last docutils">
<dt>Datafeed Lines that are not default to BTgymStrategy should be explicitly defined by</dt>
<dd>__init__() or define_datalines().</dd>
</dl>
</dd>
</dl>
</li>
</ul>
</div>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_reward">
<code class="descname">get_reward</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_reward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_reward" title="Permalink to this definition">¶</a></dt>
<dd><p>Shapes reward function as normalized single trade realized profit/loss,
augmented with potential-based reward shaping functions in form of:
F(s, a, s`) = gamma * FI(s`) - FI(s);</p>
<ul class="simple">
<li>potential FI_1 is current normalized unrealized profit/loss;</li>
</ul>
<p>EXCLUDED/ - potential FI_2 is current normalized broker value.
EXCLUDED/ - FI_3: penalizing exposure toward the end of episode</p>
<dl class="docutils">
<dt>Paper:</dt>
<dd><dl class="first last docutils">
<dt>“Policy invariance under reward transformations:</dt>
<dd>Theory and application to reward shaping” by A. Ng et al., 1999;
<a class="reference external" href="http://www.robotics.stanford.edu/~ang/papers/shaping-icml99.pdf">http://www.robotics.stanford.edu/~ang/papers/shaping-icml99.pdf</a></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_info">
<code class="descname">get_info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Composes information part of environment response,
can be any object. Override to own taste.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Due to ‘skip_frame’ feature, INFO part of environment response transmitted by server can be  a list
containing either all skipped frame’s info objects, i.e. [info[-9], info[-8], …, info[0]] or
just latest one, [info[0]]. This behaviour is set inside btgym.server._BTgymAnalyzer().next() method.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_done">
<code class="descname">get_done</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_done"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_done" title="Permalink to this definition">¶</a></dt>
<dd><p>Episode termination estimator,
defines any trading logic conditions episode stop is called upon, e.g. &lt;OMG! Stop it, we became too rich!&gt;.
It is just a structural a convention method. Default method is empty.</p>
<dl class="docutils">
<dt>Expected to return:</dt>
<dd>tuple (&lt;is_done, type=bool&gt;, &lt;message, type=str&gt;).</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.notify_order">
<code class="descname">notify_order</code><span class="sig-paren">(</span><em>order</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.notify_order"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.notify_order" title="Permalink to this definition">¶</a></dt>
<dd><p>Shamelessly taken from backtrader tutorial.
TODO: better multi data support</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="btgym-strategy-observers-module">
<h2>btgym.strategy.observers module<a class="headerlink" href="#btgym-strategy-observers-module" title="Permalink to this headline">¶</a></h2>
<span class="target" id="module-btgym.strategy.observers"></span><dl class="class">
<dt id="btgym.strategy.observers.Reward">
<em class="property">class </em><code class="descclassname">btgym.strategy.observers.</code><code class="descname">Reward</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/observers.html#Reward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.observers.Reward" title="Permalink to this definition">¶</a></dt>
<dd><p>Keeps track of reward values.</p>
</dd></dl>

<dl class="class">
<dt id="btgym.strategy.observers.Position">
<em class="property">class </em><code class="descclassname">btgym.strategy.observers.</code><code class="descname">Position</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/observers.html#Position"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.observers.Position" title="Permalink to this definition">¶</a></dt>
<dd><p>Keeps track of position size.</p>
</dd></dl>

<dl class="class">
<dt id="btgym.strategy.observers.NormPnL">
<em class="property">class </em><code class="descclassname">btgym.strategy.observers.</code><code class="descname">NormPnL</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/observers.html#NormPnL"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.observers.NormPnL" title="Permalink to this definition">¶</a></dt>
<dd><p>Keeps track of PnL stats.</p>
</dd></dl>

</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="btgym.monitor.html" class="btn btn-neutral float-right" title="btgym.monitor package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="btgym.html" class="btn btn-neutral" title="btgym.dataserver module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, 2018, Andrew Muzikin.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>